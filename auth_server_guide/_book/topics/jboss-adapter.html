<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>JBoss/Wildfly Adapter | Keycloak</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="../topics/tomcat-adapter.html" />
    
    
    <link rel="prev" href="../topics/adapter-config.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="8.1"
        data-chapter-title="JBoss/Wildfly Adapter"
        data-filepath="topics/jboss-adapter.adoc"
        data-basepath=".."
        data-revision="Tue Apr 05 2016 21:38:08 GMT+0530 (IST)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="topics/preface.html">
            
            <span><b>1.</b> Overview</span>
            
            
        </li>
    
        <li class="chapter " data-level="2" data-path="topics/Overview.html">
            
                
                    <a href="../topics/Overview.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Overview
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3" data-path="topics/server-installation.html">
            
                
                    <a href="../topics/server-installation.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Installation and Configuration of Keycloak Server
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="topics/providers.html">
            
                
                    <a href="../topics/providers.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Providers and SPIs
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5" data-path="topics/openshift.html">
            
                
                    <a href="../topics/openshift.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        Running Keycloak Server on OpenShift
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6" data-path="topics/admin-permissions.html">
            
                
                    <a href="../topics/admin-permissions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        Master Admin Access Control
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7" data-path="topics/per-realm-admin-permissions.html">
            
                
                    <a href="../topics/per-realm-admin-permissions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        Per Realm Admin Access Control
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8" data-path="topics/adapter-config.html">
            
                
                    <a href="../topics/adapter-config.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        Adapters
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="8.1" data-path="topics/jboss-adapter.html">
            
                
                    <a href="../topics/jboss-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.1.</b>
                        
                        JBoss/Wildfly Adapter
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="topics/tomcat-adapter.html">
            
                
                    <a href="../topics/tomcat-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.2.</b>
                        
                        Tomcat 6, 7 and 8 Adapters
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.3" data-path="topics/jetty9-adapter.html">
            
                
                    <a href="../topics/jetty9-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.3.</b>
                        
                        Jetty 9.x Adapters
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.4" data-path="topics/jetty8-adapter.html">
            
                
                    <a href="../topics/jetty8-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.4.</b>
                        
                        Jetty 8.1.x Adapter
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.5" data-path="topics/servlet-filter-adapter.html">
            
                
                    <a href="../topics/servlet-filter-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.5.</b>
                        
                        Java Servlet Filter Adapter
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.6" data-path="topics/fuse-adapter.html">
            
                
                    <a href="../topics/fuse-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.6.</b>
                        
                        JBoss Fuse and Apache Karaf Adapter
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.7" data-path="topics/javascript-adapter.html">
            
                
                    <a href="../topics/javascript-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.7.</b>
                        
                        Javascript Adapter
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.8" data-path="topics/spring-boot-adapter.html">
            
                
                    <a href="../topics/spring-boot-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.8.</b>
                        
                        Spring Boot Adapter
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.9" data-path="topics/spring-security-adapter.html">
            
                
                    <a href="../topics/spring-security-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.9.</b>
                        
                        Spring Security Adapter
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.10" data-path="topics/installed-applications.html">
            
                
                    <a href="../topics/installed-applications.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.10.</b>
                        
                        Installed Applications
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.11" data-path="topics/logout.html">
            
                
                    <a href="../topics/logout.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.11.</b>
                        
                        Logout
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.12" data-path="topics/adapter_error_handling.html">
            
                
                    <a href="../topics/adapter_error_handling.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.12.</b>
                        
                        Error Handling
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.13" data-path="topics/multi-tenancy.html">
            
                
                    <a href="../topics/multi-tenancy.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.13.</b>
                        
                        Multi Tenancy
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.14" data-path="topics/jaas.html">
            
                
                    <a href="../topics/jaas.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.14.</b>
                        
                        JAAS plugin
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="9" data-path="topics/client-registration.html">
            
                
                    <a href="../topics/client-registration.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                        Client Registration
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10" data-path="topics/identity-broker.html">
            
                
                    <a href="../topics/identity-broker.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                        Identity Broker
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="11" data-path="topics/themes.html">
            
                
                    <a href="../topics/themes.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>11.</b>
                        
                        Themes
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="12" data-path="topics/recaptcha.html">
            
                
                    <a href="../topics/recaptcha.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>12.</b>
                        
                        Recaptcha Support on Registration
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="13" data-path="topics/email.html">
            
                
                    <a href="../topics/email.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>13.</b>
                        
                        Email
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="14" data-path="topics/access-types.html">
            
                
                    <a href="../topics/access-types.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>14.</b>
                        
                        Client Access Types
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="15" data-path="topics/roles.html">
            
                
                    <a href="../topics/roles.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>15.</b>
                        
                        Roles
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="16" data-path="topics/groups.html">
            
                
                    <a href="../topics/groups.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>16.</b>
                        
                        Groups
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="17" data-path="topics/direct-access.html">
            
                
                    <a href="../topics/direct-access.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>17.</b>
                        
                        Direct Access Grants
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="18" data-path="topics/service-accounts.html">
            
                
                    <a href="../topics/service-accounts.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>18.</b>
                        
                        Service Accounts
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="19" data-path="topics/cors.html">
            
                
                    <a href="../topics/cors.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>19.</b>
                        
                        CORS
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="20" data-path="topics/timeouts.html">
            
                
                    <a href="../topics/timeouts.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>20.</b>
                        
                        Cookie settings, Session Timeouts, and Token Lifespans
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="21" data-path="topics/admin-rest-api.html">
            
                
                    <a href="../topics/admin-rest-api.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>21.</b>
                        
                        Admin REST API
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="22" data-path="topics/events.html">
            
                
                    <a href="../topics/events.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>22.</b>
                        
                        Events
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="23" data-path="topics/user-federation.html">
            
                
                    <a href="../topics/user-federation.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>23.</b>
                        
                        User Federation SPI and LDAP/AD Integration
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="24" data-path="topics/kerberos.html">
            
                
                    <a href="../topics/kerberos.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>24.</b>
                        
                        Kerberos brokering
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="25" data-path="topics/export-import.html">
            
                
                    <a href="../topics/export-import.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>25.</b>
                        
                        Export and Import
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="26" data-path="topics/cache.html">
            
                
                    <a href="../topics/cache.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>26.</b>
                        
                        Server Cache
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="27" data-path="topics/saml.html">
            
                
                    <a href="../topics/saml.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>27.</b>
                        
                        SAML SSO
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="28" data-path="topics/security-vulnerabilities.html">
            
                
                    <a href="../topics/security-vulnerabilities.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>28.</b>
                        
                        Security Vulnerabilities
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="29" data-path="topics/clustering.html">
            
                
                    <a href="../topics/clustering.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>29.</b>
                        
                        Clustering
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="30" data-path="topics/application-clustering.html">
            
                
                    <a href="../topics/application-clustering.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>30.</b>
                        
                        Application Clustering
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="31" data-path="topics/proxy.html">
            
                
                    <a href="../topics/proxy.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>31.</b>
                        
                        Keycloak Security Proxy
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="32" data-path="topics/custom-attributes.html">
            
                
                    <a href="../topics/custom-attributes.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>32.</b>
                        
                        Custom User Attributes
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="33" data-path="topics/protocol-mappers.html">
            
                
                    <a href="../topics/protocol-mappers.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>33.</b>
                        
                        OIDC Token and SAML Assertion Mappings
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="34" data-path="topics/auth-spi.html">
            
                
                    <a href="../topics/auth-spi.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>34.</b>
                        
                        Custom Authentication, Registration, and Required Actions
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="35" data-path="topics/MigrationFromOlderVersions.html">
            
                
                    <a href="../topics/MigrationFromOlderVersions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>35.</b>
                        
                        Migration from older versions
                    </a>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >Keycloak</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="_jboss_adapter">JBoss/Wildfly Adapter</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>To be able to secure WAR apps deployed on JBoss AS 7.1.1, JBoss EAP 6.x, or Wildfly, you must install and configure the Keycloak Subsystem.
You then have two options to secure your WARs.
You can provide a keycloak config file in your WAR and change the auth-method to KEYCLOAK within web.xml.
Alternatively, you don&#x2019;t have to crack open your WARs at all and can apply Keycloak via the Keycloak Subsystem configuration in standalone.xml.
Both methods are described in this section.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jboss_adapter_installation">Adapter Installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Adapters are no longer included with the appliance or war distribution.
Each adapter is a separate download on the Keycloak download site.
They are also available as a maven artifact.</p>
</div>
<div class="paragraph">
<p>Install on Wildfly 9 or 10:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cd $WILDFLY_HOME
$ unzip keycloak-wildfly-adapter-dist.zip</code></pre>
</div>
</div>
<div class="paragraph">
<p>Install on Wildfly 8:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cd $WILDFLY_HOME
$ unzip keycloak-wf8-adapter-dist.zip</code></pre>
</div>
</div>
<div class="paragraph">
<p>Install on JBoss EAP 6.x:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cd $JBOSS_HOME
$ unzip keycloak-eap6-adapter-dist.zip</code></pre>
</div>
</div>
<div class="paragraph">
<p>Install on JBoss AS 7.1.1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cd $JBOSS_HOME
$ unzip keycloak-as7-adapter-dist.zip</code></pre>
</div>
</div>
<div class="paragraph">
<p>This zip file creates new JBoss Modules specific to the Wildfly Keycloak Adapter within your Wildfly distro.</p>
</div>
<div class="paragraph">
<p>After adding the Keycloak modules, you must then enable the Keycloak Subsystem within your app server&#x2019;s server configuration: <code>domain.xml</code> or <code>standalone.xml</code>.</p>
</div>
<div class="paragraph">
<p>There is a CLI script that will help you modify your server configuration.
Start the server and run the script  from the server&#x2019;s bin directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cd $JBOSS_HOME/bin
$ jboss-cli.sh -c --file=adapter-install.cli</code></pre>
</div>
</div>
<div class="paragraph">
<p>The script will add the extension, subsystem, and optional security-domain as described below.</p>
</div>
<div class="paragraph">
<p>For more recent versions of WildFly there&#x2019;s also a offline CLI script that can be used to install the adapter while the server is not running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cd $JBOSS_HOME/bin
$ jboss-cli.sh -c --file=adapter-install-offline.cli</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;server xmlns=&quot;urn:jboss:domain:1.4&quot;&gt;

    &lt;extensions&gt;
        &lt;extension module=&quot;org.keycloak.keycloak-adapter-subsystem&quot;/&gt;
          ...
    &lt;/extensions&gt;

    &lt;profile&gt;
        &lt;subsystem xmlns=&quot;urn:jboss:domain:keycloak:1.1&quot;/&gt;
         ...
    &lt;/profile&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The keycloak security domain should be used with EJBs and other components when you need the security context created in the secured web tier to be propagated to the EJBs (other EE component) you are invoking.
Otherwise this configuration is optional.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;server xmlns=&quot;urn:jboss:domain:1.4&quot;&gt;
 &lt;subsystem xmlns=&quot;urn:jboss:domain:security:1.2&quot;&gt;
    &lt;security-domains&gt;
...
      &lt;security-domain name=&quot;keycloak&quot;&gt;
         &lt;authentication&gt;
           &lt;login-module code=&quot;org.keycloak.adapters.jboss.KeycloakLoginModule&quot;
                         flag=&quot;required&quot;/&gt;
          &lt;/authentication&gt;
      &lt;/security-domain&gt;
    &lt;/security-domains&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, if you have a JAX-RS service that is an EJB within your WEB-INF/classes directory, you&#x2019;ll want to annotate it with the @SecurityDomain annotation as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>import org.jboss.ejb3.annotation.SecurityDomain;
import org.jboss.resteasy.annotations.cache.NoCache;

import javax.annotation.security.RolesAllowed;
import javax.ejb.EJB;
import javax.ejb.Stateless;
import javax.ws.rs.GET;
import javax.ws.rs.Path;
import javax.ws.rs.Produces;
import java.util.ArrayList;
import java.util.List;

@Path(&quot;customers&quot;)
@Stateless
@SecurityDomain(&quot;keycloak&quot;)
public class CustomerService {

    @EJB
    CustomerDB db;

    @GET
    @Produces(&quot;application/json&quot;)
    @NoCache
    @RolesAllowed(&quot;db_user&quot;)
    public List&lt;String&gt; getCustomers() {
        return db.getCustomers();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We hope to improve our integration in the future so that you don&#x2019;t have to specify the @SecurityDomain annotation when you want to propagate a keycloak security context to the EJB tier.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_required_per_war_configuration">Required Per WAR Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes how to secure a WAR directly by adding config and editing files within your WAR package.</p>
</div>
<div class="paragraph">
<p>The first thing you must do is create a <code>keycloak.json</code> adapter config file within the <code>WEB-INF</code> directory of your WAR.
The format of this config file is describe in the <a href="#_adapter_config">general adapter configuration</a>            section.</p>
</div>
<div class="paragraph">
<p>Next you must set the <code>auth-method</code> to <code>KEYCLOAK</code> in <code>web.xml</code>.
You also have to use standard servlet security to specify role-base constraints on your URLs.
Here&#x2019;s an example pulled from one of the examples that comes distributed with Keycloak.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;web-app xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot;
      xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
      xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;
      version=&quot;3.0&quot;&gt;

	&lt;module-name&gt;customer-portal&lt;/module-name&gt;

    &lt;security-constraint&gt;
        &lt;web-resource-collection&gt;
            &lt;web-resource-name&gt;Admins&lt;/web-resource-name&gt;
            &lt;url-pattern&gt;/admin/*&lt;/url-pattern&gt;
        &lt;/web-resource-collection&gt;
        &lt;auth-constraint&gt;
            &lt;role-name&gt;admin&lt;/role-name&gt;
        &lt;/auth-constraint&gt;
        &lt;user-data-constraint&gt;
            &lt;transport-guarantee&gt;CONFIDENTIAL&lt;/transport-guarantee&gt;
        &lt;/user-data-constraint&gt;
    &lt;/security-constraint&gt;
    &lt;security-constraint&gt;
        &lt;web-resource-collection&gt;
            &lt;web-resource-name&gt;Customers&lt;/web-resource-name&gt;
            &lt;url-pattern&gt;/customers/*&lt;/url-pattern&gt;
        &lt;/web-resource-collection&gt;
        &lt;auth-constraint&gt;
            &lt;role-name&gt;user&lt;/role-name&gt;
        &lt;/auth-constraint&gt;
        &lt;user-data-constraint&gt;
            &lt;transport-guarantee&gt;CONFIDENTIAL&lt;/transport-guarantee&gt;
        &lt;/user-data-constraint&gt;
    &lt;/security-constraint&gt;

    &lt;login-config&gt;
        &lt;auth-method&gt;KEYCLOAK&lt;/auth-method&gt;
        &lt;realm-name&gt;this is ignored currently&lt;/realm-name&gt;
    &lt;/login-config&gt;

    &lt;security-role&gt;
        &lt;role-name&gt;admin&lt;/role-name&gt;
    &lt;/security-role&gt;
    &lt;security-role&gt;
        &lt;role-name&gt;user&lt;/role-name&gt;
    &lt;/security-role&gt;
&lt;/web-app&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_securing_wars_via_keycloak_subsystem">Securing WARs via Keycloak Subsystem</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You do not have to crack open a WAR to secure it with Keycloak.
Alternatively, you can externally secure it via the Keycloak Adapter Subsystem.
While you don&#x2019;t have to specify KEYCLOAK as an <code>auth-method</code>, you still have to define the <code>security-constraints</code> in <code>web.xml</code>.
You do not, however, have to create a <code>WEB-INF/keycloak.json</code> file.
This metadata is instead defined within XML in your server&#x2019;s <code>domain.xml</code> or <code>standalone.xml</code> subsystem configuration section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;extensions&gt;
  &lt;extension module=&quot;org.keycloak.keycloak-adapter-subsystem&quot;/&gt;
&lt;/extensions&gt;

&lt;profile&gt;
  &lt;subsystem xmlns=&quot;urn:jboss:domain:keycloak:1.1&quot;&gt;
     &lt;secure-deployment name=&quot;WAR MODULE NAME.war&quot;&gt;
        &lt;realm&gt;demo&lt;/realm&gt;
        &lt;realm-public-key&gt;MIGfMA0GCSqGSIb3DQEBAQUAA&lt;/realm-public-key&gt;
        &lt;auth-server-url&gt;http://localhost:8081/auth&lt;/auth-server-url&gt;
        &lt;ssl-required&gt;external&lt;/ssl-required&gt;
        &lt;resource&gt;customer-portal&lt;/resource&gt;
        &lt;credential name=&quot;secret&quot;&gt;password&lt;/credential&gt;
     &lt;/secure-deployment&gt;
  &lt;/subsystem&gt;
&lt;/profile&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>secure-deployment</code> <code>name</code> attribute identifies the WAR you want to secure.
Its value is the <code>module-name</code> defined in <code>web.xml</code> with <code>.war</code> appended.
The rest of the configuration corresponds pretty much one to one with the <code>keycloak.json</code> configuration options defined in <a href="#_adapter_config">general adapter configuration</a>.
The exception is the <code>credential</code> element.</p>
</div>
<div class="paragraph">
<p>To make it easier for you, you can go to the Keycloak Adminstration Console and go to the Application/Installation tab of the application this WAR is aligned with.
It provides an example XML file you can cut and paste.</p>
</div>
<div class="paragraph">
<p>There is an additional convenience format for this XML if you have multiple WARs you are deployment that are secured by the same domain.
This format allows you to define common configuration items in one place under the <code>realm</code> element.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;subsystem xmlns=&quot;urn:jboss:domain:keycloak:1.1&quot;&gt;
    &lt;realm name=&quot;demo&quot;&gt;
        &lt;realm-public-key&gt;MIGfMA0GCSqGSIb3DQEBA&lt;/realm-public-key&gt;
        &lt;auth-server-url&gt;http://localhost:8080/auth&lt;/auth-server-url&gt;
        &lt;ssl-required&gt;external&lt;/ssl-required&gt;
    &lt;/realm&gt;
    &lt;secure-deployment name=&quot;customer-portal.war&quot;&gt;
        &lt;realm&gt;demo&lt;/realm&gt;
        &lt;resource&gt;customer-portal&lt;/resource&gt;
        &lt;credential name=&quot;secret&quot;&gt;password&lt;/credential&gt;
    &lt;/secure-deployment&gt;
    &lt;secure-deployment name=&quot;product-portal.war&quot;&gt;
        &lt;realm&gt;demo&lt;/realm&gt;
        &lt;resource&gt;product-portal&lt;/resource&gt;
        &lt;credential name=&quot;secret&quot;&gt;password&lt;/credential&gt;
    &lt;/secure-deployment&gt;
    &lt;secure-deployment name=&quot;database.war&quot;&gt;
        &lt;realm&gt;demo&lt;/realm&gt;
        &lt;resource&gt;database-service&lt;/resource&gt;
        &lt;bearer-only&gt;true&lt;/bearer-only&gt;
    &lt;/secure-deployment&gt;
&lt;/subsystem&gt;</code></pre>
</div>
</div>
</div>
</div>
                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../topics/adapter-config.html" class="navigation navigation-prev " aria-label="Previous page: Adapters"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../topics/tomcat-adapter.html" class="navigation navigation-next " aria-label="Next page: Tomcat 6, 7 and 8 Adapters"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-livereload/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"livereload":{}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
