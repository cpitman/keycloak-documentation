<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Application Clustering | Keycloak Reference Guide</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="../topics/proxy.html" />
    
    
    <link rel="prev" href="../topics/clustering.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="30"
        data-chapter-title="Application Clustering"
        data-filepath="topics/application-clustering.adoc"
        data-basepath=".."
        data-revision="Wed Apr 06 2016 12:47:24 GMT+0530 (IST)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="topics/preface.html">
            
                
                    <a href="../topics/preface.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Preface
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2" data-path="topics/Overview.html">
            
                
                    <a href="../topics/Overview.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Overview
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="topics/overview_key_concepts.html">
            
                
                    <a href="../topics/overview_key_concepts.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        Key Concepts in Keycloak
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="topics/overview_How_Security_Work_in_Keycloak.html">
            
                
                    <a href="../topics/overview_How_Security_Work_in_Keycloak.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        How Security Work in Keycloak?
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.1" data-path="topics/overview_permission_scopes.html">
            
                
                    <a href="../topics/overview_permission_scopes.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.1.</b>
                        
                        Permission Scopes
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="topics/server-installation.html">
            
                
                    <a href="../topics/server-installation.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Installation and Configuration of Keycloak Server
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="topics/providers.html">
            
                
                    <a href="../topics/providers.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Providers and SPIs
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5" data-path="topics/openshift.html">
            
                
                    <a href="../topics/openshift.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        Running Keycloak Server on OpenShift
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6" data-path="topics/admin-permissions.html">
            
                
                    <a href="../topics/admin-permissions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        Master Admin Access Control
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7" data-path="topics/per-realm-admin-permissions.html">
            
                
                    <a href="../topics/per-realm-admin-permissions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        Per Realm Admin Access Control
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8" data-path="topics/adapter-config.html">
            
                
                    <a href="../topics/adapter-config.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        Adapters
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="8.1" data-path="topics/jboss-adapter.html">
            
                
                    <a href="../topics/jboss-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.1.</b>
                        
                        JBoss/Wildfly Adapter
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="topics/tomcat-adapter.html">
            
                
                    <a href="../topics/tomcat-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.2.</b>
                        
                        Tomcat 6, 7 and 8 Adapters
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.3" data-path="topics/jetty9-adapter.html">
            
                
                    <a href="../topics/jetty9-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.3.</b>
                        
                        Jetty 9.x Adapters
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.4" data-path="topics/jetty8-adapter.html">
            
                
                    <a href="../topics/jetty8-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.4.</b>
                        
                        Jetty 8.1.x Adapter
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.5" data-path="topics/servlet-filter-adapter.html">
            
                
                    <a href="../topics/servlet-filter-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.5.</b>
                        
                        Java Servlet Filter Adapter
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.6" data-path="topics/fuse-adapter.html">
            
                
                    <a href="../topics/fuse-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.6.</b>
                        
                        JBoss Fuse and Apache Karaf Adapter
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.7" data-path="topics/javascript-adapter.html">
            
                
                    <a href="../topics/javascript-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.7.</b>
                        
                        Javascript Adapter
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.8" data-path="topics/spring-boot-adapter.html">
            
                
                    <a href="../topics/spring-boot-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.8.</b>
                        
                        Spring Boot Adapter
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.9" data-path="topics/spring-security-adapter.html">
            
                
                    <a href="../topics/spring-security-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.9.</b>
                        
                        Spring Security Adapter
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.10" data-path="topics/installed-applications.html">
            
                
                    <a href="../topics/installed-applications.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.10.</b>
                        
                        Installed Applications
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.11" data-path="topics/logout.html">
            
                
                    <a href="../topics/logout.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.11.</b>
                        
                        Logout
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.12" data-path="topics/adapter_error_handling.html">
            
                
                    <a href="../topics/adapter_error_handling.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.12.</b>
                        
                        Error Handling
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.13" data-path="topics/multi-tenancy.html">
            
                
                    <a href="../topics/multi-tenancy.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.13.</b>
                        
                        Multi Tenancy
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.14" data-path="topics/jaas.html">
            
                
                    <a href="../topics/jaas.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.14.</b>
                        
                        JAAS plugin
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="9" data-path="topics/client-registration.html">
            
                
                    <a href="../topics/client-registration.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                        Client Registration
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10" data-path="topics/identity-broker.html">
            
                
                    <a href="../topics/identity-broker.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                        Identity Broker
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="11" data-path="topics/themes.html">
            
                
                    <a href="../topics/themes.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>11.</b>
                        
                        Themes
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="12" data-path="topics/recaptcha.html">
            
                
                    <a href="../topics/recaptcha.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>12.</b>
                        
                        Recaptcha Support on Registration
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="13" data-path="topics/email.html">
            
                
                    <a href="../topics/email.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>13.</b>
                        
                        Email
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="14" data-path="topics/access-types.html">
            
                
                    <a href="../topics/access-types.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>14.</b>
                        
                        Client Access Types
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="15" data-path="topics/roles.html">
            
                
                    <a href="../topics/roles.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>15.</b>
                        
                        Roles
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="16" data-path="topics/groups.html">
            
                
                    <a href="../topics/groups.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>16.</b>
                        
                        Groups
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="17" data-path="topics/direct-access.html">
            
                
                    <a href="../topics/direct-access.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>17.</b>
                        
                        Direct Access Grants
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="18" data-path="topics/service-accounts.html">
            
                
                    <a href="../topics/service-accounts.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>18.</b>
                        
                        Service Accounts
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="19" data-path="topics/cors.html">
            
                
                    <a href="../topics/cors.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>19.</b>
                        
                        CORS
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="20" data-path="topics/timeouts.html">
            
                
                    <a href="../topics/timeouts.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>20.</b>
                        
                        Cookie settings, Session Timeouts, and Token Lifespans
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="21" data-path="topics/admin-rest-api.html">
            
                
                    <a href="../topics/admin-rest-api.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>21.</b>
                        
                        Admin REST API
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="22" data-path="topics/events.html">
            
                
                    <a href="../topics/events.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>22.</b>
                        
                        Events
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="23" data-path="topics/user-federation.html">
            
                
                    <a href="../topics/user-federation.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>23.</b>
                        
                        User Federation SPI and LDAP/AD Integration
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="24" data-path="topics/kerberos.html">
            
                
                    <a href="../topics/kerberos.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>24.</b>
                        
                        Kerberos brokering
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="25" data-path="topics/export-import.html">
            
                
                    <a href="../topics/export-import.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>25.</b>
                        
                        Export and Import
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="26" data-path="topics/cache.html">
            
                
                    <a href="../topics/cache.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>26.</b>
                        
                        Server Cache
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="27" data-path="topics/saml.html">
            
                
                    <a href="../topics/saml.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>27.</b>
                        
                        SAML SSO
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="28" data-path="topics/security-vulnerabilities.html">
            
                
                    <a href="../topics/security-vulnerabilities.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>28.</b>
                        
                        Security Vulnerabilities
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="29" data-path="topics/clustering.html">
            
                
                    <a href="../topics/clustering.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>29.</b>
                        
                        Clustering
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="30" data-path="topics/application-clustering.html">
            
                
                    <a href="../topics/application-clustering.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>30.</b>
                        
                        Application Clustering
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="31" data-path="topics/proxy.html">
            
                
                    <a href="../topics/proxy.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>31.</b>
                        
                        Keycloak Security Proxy
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="32" data-path="topics/custom-attributes.html">
            
                
                    <a href="../topics/custom-attributes.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>32.</b>
                        
                        Custom User Attributes
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="33" data-path="topics/protocol-mappers.html">
            
                
                    <a href="../topics/protocol-mappers.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>33.</b>
                        
                        OIDC Token and SAML Assertion Mappings
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="34" data-path="topics/auth-spi.html">
            
                
                    <a href="../topics/auth-spi.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>34.</b>
                        
                        Custom Authentication, Registration, and Required Actions
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="35" data-path="topics/MigrationFromOlderVersions.html">
            
                
                    <a href="../topics/MigrationFromOlderVersions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>35.</b>
                        
                        Migration from older versions
                    </a>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >Keycloak Reference Guide</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="_applicationclustering">Application Clustering</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This chapter is focused on clustering support for your own AS7, EAP6 or Wildfly applications, which are secured by Keycloak.
We support various deployment scenarios according if your application is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>stateless or stateful</p>
</li>
<li>
<p>distributable (replicated http session) or non-distributable and just relying on sticky sessions provided by loadbalancer</p>
</li>
<li>
<p>deployed on same or different cluster hosts where keycloak servers are deployed</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The situation is a bit tricky as application communicates with Keycloak directly within user&#x2019;s browser (for example redirecting to login screen), but there is also backend (out-of-bound) communication between keycloak and application, which is hidden from end-user and his browser and hence can&#x2019;t rely on sticky sessions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
To enable distributable (replicated) HTTP Sessions in your application, you may need to do some additional steps.
Usually you need to put tag into <code>WEB-INF/web.xml</code> file of your application and possibly do some additional steps to configure underlying cluster cache (In case of Wildfly, the implementation of cluster cache is based on Infinispan). These steps are server specific, so consult documentation of your application server for more details.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_stateless_token_store">Stateless token store</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, the servlet web application secured by Keycloak uses HTTP session to store information about authenticated user account.
This means that this info could be replicated across cluster and your application will safely survive failover of some cluster node.</p>
</div>
<div class="paragraph">
<p>However if you don&#x2019;t need or don&#x2019;t want to use HTTP Session, you may alternatively save all info about authenticated account into cookie.
This is useful especially if your application is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>stateless application without need of HTTP Session, but with requirement to be safe to failover of some cluster node</p>
</li>
<li>
<p>stateful application, but you don&#x2019;t want sensitive token data to be saved in HTTP session</p>
</li>
<li>
<p>stateless application relying on loadbalancer, which is not aware of sticky sessions (in this case cookie is your only way)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To configure this, you can add this line to configuration of your adapter in <code>WEB-INF/keycloak.json</code> of your application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&quot;token-store&quot;: &quot;cookie&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Default value of <code>token-store</code> is <code>session</code>, hence saving data in HTTP session.</p>
</div>
<div class="paragraph">
<p>One limitation of cookie store is, that whole info about account is passed in cookie KEYCLOAK_ADAPTER_STATE in each HTTP request.
Hence it&#x2019;s not the best for network performance.
Another small limitation is limited support for Single-Sign out.
It works without issues if you init servlet logout (HttpServletRequest.logout) from this application itself as the adapter will delete the KEYCLOAK_ADAPTER_STATE cookie.
But back-channel logout initialized from different application can&#x2019;t be propagated by Keycloak to this application with cookie store.
Hence it&#x2019;s recommended to use very short value of access token timeout (1 minute for example).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_relative_uri_optimization">Relative URI optimization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In many deployment scenarios will be Keycloak and secured applications deployed on same cluster hosts.
For this case Keycloak already provides option to use relative URI as value of option <em>auth-server-url</em> in <code>WEB-INF/keycloak.json</code> . In this case, the URI of Keycloak server is resolved from the URI of current request.</p>
</div>
<div class="paragraph">
<p>For example if your loadbalancer is on <em><a href="https://loadbalancer.com/myapp" class="bare" target="_blank">https://loadbalancer.com/myapp</a></em> and auth-server-url is <em>/auth</em>, then relative URI of Keycloak is resolved to be  <em><a href="https://loadbalancer.com/auth" class="bare" target="_blank">https://loadbalancer.com/auth</a></em> .</p>
</div>
<div class="paragraph">
<p>For cluster setup, it may be even better to use option <em>auth-server-url-for-backend-request</em> . This allows to configure that backend requests between Keycloak and your application will be sent directly to same cluster host without additional round-trip through loadbalancer.
So for this, it&#x2019;s good to configure values in <code>WEB-INF/keycloak.json</code> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&quot;auth-server-url&quot;: &quot;/auth&quot;,
&quot;auth-server-url-for-backend-requests&quot;: &quot;http://${jboss.host.name}:8080/auth&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This would mean that browser requests (like redirecting to Keycloak login screen) will be still resolved relatively to current request URI like <em><a href="https://loadbalancer.com/myapp" class="bare" target="_blank">https://loadbalancer.com/myapp</a></em>, but backend (out-of-bound) requests between keycloak and your app are sent always to same cluster host with application .</p>
</div>
<div class="paragraph">
<p>Note that additionally to network optimization, you may not need &quot;https&quot; in this case as application and keycloak are communicating directly within same cluster host.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_admin_url_configuration">Admin URL configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Admin URL for particular application can be configured in Keycloak admin console.
It&#x2019;s used by Keycloak server to send backend requests to application for various tasks, like logout users or push revocation policies.</p>
</div>
<div class="paragraph">
<p>For example logout of user from Keycloak works like this:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>User sends logout request from one of applications where he is logged.</p>
</li>
<li>
<p>Then application will send logout request to Keycloak</p>
</li>
<li>
<p>Keycloak server logout user in itself, and then it re-sends logout request by backend channel to all applications where user is logged.
Keycloak is using admin URL for this.
So logout is propagated to all apps.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You may again use relative values for admin URL, but in cluster it may not be the best similarly like in <a href="#_relative_uri_optimization">previous section</a> .</p>
</div>
<div class="paragraph">
<p>Some examples of possible values of admin URL are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="http://${jboss.host.name}:8080/myapp" class="bare" target="_blank">http://${jboss.host.name}:8080/myapp</a></dt>
<dd>
<p>This is best choice if &quot;myapp&quot; is deployed on same cluster hosts like Keycloak and is distributable.
In this case Keycloak server sends logout request to itself, hence no communication with loadbalancer or other cluster nodes and no additional network traffic.</p>
</dd>
<dt class="hdlist1"><a href="http://${application.session.host}:8080/myapp" class="bare" target="_blank">http://${application.session.host}:8080/myapp</a></dt>
<dd>
<p>Keycloak will track hosts where is particular HTTP Session served and it will send session invalidation message to proper cluster node.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_registration_app_nodes">Registration of application nodes to Keycloak</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Previous section describes how can Keycloak send logout request to proper application node.
However in some cases admin may want to propagate admin tasks to all registered cluster nodes, not just one of them.
For example push new notBefore for realm or application, or logout all users from all applications on all cluster nodes.</p>
</div>
<div class="paragraph">
<p>In this case Keycloak should be aware of all application cluster nodes, so it could send event to all of them.
To achieve this, we support auto-discovery mechanism:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Once new application node joins cluster, it sends registration request to Keycloak server</p>
</li>
<li>
<p>The request may be re-sent to Keycloak in configured periodic intervals</p>
</li>
<li>
<p>If Keycloak won&#x2019;t receive re-registration request within specified timeout (should be greater than period from point 2) then it automatically unregister particular node</p>
</li>
<li>
<p>Node is also unregistered in Keycloak when it sends unregistration request, which is usually during node shutdown or application undeployment.
This may not work properly for forced shutdown when undeployment listeners are not invoked, so here you need to rely on automatic unregistration from point 3 .</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Sending startup registrations and periodic re-registration is disabled by default, as it&#x2019;s main usecase is just cluster deployment.
In <code>WEB-INF/keycloak.json</code> of your application, you can specify:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&quot;register-node-at-startup&quot;: true,
&quot;register-node-period&quot;: 600,</code></pre>
</div>
</div>
<div class="paragraph">
<p>which means that registration is sent at startup (accurately when 1st request is served by the application node) and then it&#x2019;s resent each 10 minutes.</p>
</div>
<div class="paragraph">
<p>In Keycloak admin console you can specify the maximum node re-registration timeout (makes sense to have it bigger than <em>register-node-period</em> from adapter configuration for particular application). Also you can manually add and remove cluster nodes in admin console, which is useful if you don&#x2019;t want to rely on adapter&#x2019;s automatic registration or if you want to remove stale application nodes, which weren&#x2019;t unregistered (for example due to forced shutdown).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_refresh_token_each_req">Refresh token in each request</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, application adapter tries to refresh access token when it&#x2019;s expired (period can be specified as <a href="#_token_timeouts">Access Token Lifespan</a>) . However if you don&#x2019;t want to rely on the fact, that Keycloak is able to successfully propagate admin events like logout to your application nodes, then you have possibility to configure adapter to refresh access token in each HTTP request.</p>
</div>
<div class="paragraph">
<p>In <code>WEB-INF/keycloak.json</code> you can configure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&quot;always-refresh-token&quot;: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that this has big performance impact.
It&#x2019;s useful just if performance is not priority, but security is critical and you can&#x2019;t rely on logout and push notBefore propagation from Keycloak to applications.</p>
</div>
</div>
</div>
                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../topics/clustering.html" class="navigation navigation-prev " aria-label="Previous page: Clustering"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../topics/proxy.html" class="navigation navigation-next " aria-label="Next page: Keycloak Security Proxy"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-livereload/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"livereload":{}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
