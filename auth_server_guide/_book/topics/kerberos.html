<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Kerberos brokering | Keycloak Reference Guide</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="../topics/export-import.html" />
    
    
    <link rel="prev" href="../topics/user-federation.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="24"
        data-chapter-title="Kerberos brokering"
        data-filepath="topics/kerberos.adoc"
        data-basepath=".."
        data-revision="Wed Apr 06 2016 12:47:24 GMT+0530 (IST)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="topics/preface.html">
            
                
                    <a href="../topics/preface.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Preface
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2" data-path="topics/Overview.html">
            
                
                    <a href="../topics/Overview.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Overview
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="topics/overview_key_concepts.html">
            
                
                    <a href="../topics/overview_key_concepts.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        Key Concepts in Keycloak
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="topics/overview_How_Security_Work_in_Keycloak.html">
            
                
                    <a href="../topics/overview_How_Security_Work_in_Keycloak.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        How Security Work in Keycloak?
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.1" data-path="topics/overview_permission_scopes.html">
            
                
                    <a href="../topics/overview_permission_scopes.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.1.</b>
                        
                        Permission Scopes
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="topics/server-installation.html">
            
                
                    <a href="../topics/server-installation.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Installation and Configuration of Keycloak Server
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="topics/providers.html">
            
                
                    <a href="../topics/providers.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Providers and SPIs
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5" data-path="topics/openshift.html">
            
                
                    <a href="../topics/openshift.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        Running Keycloak Server on OpenShift
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6" data-path="topics/admin-permissions.html">
            
                
                    <a href="../topics/admin-permissions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        Master Admin Access Control
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7" data-path="topics/per-realm-admin-permissions.html">
            
                
                    <a href="../topics/per-realm-admin-permissions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        Per Realm Admin Access Control
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8" data-path="topics/adapter-config.html">
            
                
                    <a href="../topics/adapter-config.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        Adapters
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="8.1" data-path="topics/jboss-adapter.html">
            
                
                    <a href="../topics/jboss-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.1.</b>
                        
                        JBoss/Wildfly Adapter
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="topics/tomcat-adapter.html">
            
                
                    <a href="../topics/tomcat-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.2.</b>
                        
                        Tomcat 6, 7 and 8 Adapters
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.3" data-path="topics/jetty9-adapter.html">
            
                
                    <a href="../topics/jetty9-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.3.</b>
                        
                        Jetty 9.x Adapters
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.4" data-path="topics/jetty8-adapter.html">
            
                
                    <a href="../topics/jetty8-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.4.</b>
                        
                        Jetty 8.1.x Adapter
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.5" data-path="topics/servlet-filter-adapter.html">
            
                
                    <a href="../topics/servlet-filter-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.5.</b>
                        
                        Java Servlet Filter Adapter
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.6" data-path="topics/fuse-adapter.html">
            
                
                    <a href="../topics/fuse-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.6.</b>
                        
                        JBoss Fuse and Apache Karaf Adapter
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.7" data-path="topics/javascript-adapter.html">
            
                
                    <a href="../topics/javascript-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.7.</b>
                        
                        Javascript Adapter
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.8" data-path="topics/spring-boot-adapter.html">
            
                
                    <a href="../topics/spring-boot-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.8.</b>
                        
                        Spring Boot Adapter
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.9" data-path="topics/spring-security-adapter.html">
            
                
                    <a href="../topics/spring-security-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.9.</b>
                        
                        Spring Security Adapter
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.10" data-path="topics/installed-applications.html">
            
                
                    <a href="../topics/installed-applications.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.10.</b>
                        
                        Installed Applications
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.11" data-path="topics/logout.html">
            
                
                    <a href="../topics/logout.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.11.</b>
                        
                        Logout
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.12" data-path="topics/adapter_error_handling.html">
            
                
                    <a href="../topics/adapter_error_handling.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.12.</b>
                        
                        Error Handling
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.13" data-path="topics/multi-tenancy.html">
            
                
                    <a href="../topics/multi-tenancy.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.13.</b>
                        
                        Multi Tenancy
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.14" data-path="topics/jaas.html">
            
                
                    <a href="../topics/jaas.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.14.</b>
                        
                        JAAS plugin
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="9" data-path="topics/client-registration.html">
            
                
                    <a href="../topics/client-registration.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                        Client Registration
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10" data-path="topics/identity-broker.html">
            
                
                    <a href="../topics/identity-broker.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                        Identity Broker
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="11" data-path="topics/themes.html">
            
                
                    <a href="../topics/themes.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>11.</b>
                        
                        Themes
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="12" data-path="topics/recaptcha.html">
            
                
                    <a href="../topics/recaptcha.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>12.</b>
                        
                        Recaptcha Support on Registration
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="13" data-path="topics/email.html">
            
                
                    <a href="../topics/email.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>13.</b>
                        
                        Email
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="14" data-path="topics/access-types.html">
            
                
                    <a href="../topics/access-types.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>14.</b>
                        
                        Client Access Types
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="15" data-path="topics/roles.html">
            
                
                    <a href="../topics/roles.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>15.</b>
                        
                        Roles
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="16" data-path="topics/groups.html">
            
                
                    <a href="../topics/groups.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>16.</b>
                        
                        Groups
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="17" data-path="topics/direct-access.html">
            
                
                    <a href="../topics/direct-access.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>17.</b>
                        
                        Direct Access Grants
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="18" data-path="topics/service-accounts.html">
            
                
                    <a href="../topics/service-accounts.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>18.</b>
                        
                        Service Accounts
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="19" data-path="topics/cors.html">
            
                
                    <a href="../topics/cors.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>19.</b>
                        
                        CORS
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="20" data-path="topics/timeouts.html">
            
                
                    <a href="../topics/timeouts.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>20.</b>
                        
                        Cookie settings, Session Timeouts, and Token Lifespans
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="21" data-path="topics/admin-rest-api.html">
            
                
                    <a href="../topics/admin-rest-api.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>21.</b>
                        
                        Admin REST API
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="22" data-path="topics/events.html">
            
                
                    <a href="../topics/events.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>22.</b>
                        
                        Events
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="23" data-path="topics/user-federation.html">
            
                
                    <a href="../topics/user-federation.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>23.</b>
                        
                        User Federation SPI and LDAP/AD Integration
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="24" data-path="topics/kerberos.html">
            
                
                    <a href="../topics/kerberos.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>24.</b>
                        
                        Kerberos brokering
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="25" data-path="topics/export-import.html">
            
                
                    <a href="../topics/export-import.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>25.</b>
                        
                        Export and Import
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="26" data-path="topics/cache.html">
            
                
                    <a href="../topics/cache.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>26.</b>
                        
                        Server Cache
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="27" data-path="topics/saml.html">
            
                
                    <a href="../topics/saml.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>27.</b>
                        
                        SAML SSO
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="28" data-path="topics/security-vulnerabilities.html">
            
                
                    <a href="../topics/security-vulnerabilities.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>28.</b>
                        
                        Security Vulnerabilities
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="29" data-path="topics/clustering.html">
            
                
                    <a href="../topics/clustering.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>29.</b>
                        
                        Clustering
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="30" data-path="topics/application-clustering.html">
            
                
                    <a href="../topics/application-clustering.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>30.</b>
                        
                        Application Clustering
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="31" data-path="topics/proxy.html">
            
                
                    <a href="../topics/proxy.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>31.</b>
                        
                        Keycloak Security Proxy
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="32" data-path="topics/custom-attributes.html">
            
                
                    <a href="../topics/custom-attributes.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>32.</b>
                        
                        Custom User Attributes
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="33" data-path="topics/protocol-mappers.html">
            
                
                    <a href="../topics/protocol-mappers.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>33.</b>
                        
                        OIDC Token and SAML Assertion Mappings
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="34" data-path="topics/auth-spi.html">
            
                
                    <a href="../topics/auth-spi.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>34.</b>
                        
                        Custom Authentication, Registration, and Required Actions
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="35" data-path="topics/MigrationFromOlderVersions.html">
            
                
                    <a href="../topics/MigrationFromOlderVersions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>35.</b>
                        
                        Migration from older versions
                    </a>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >Keycloak Reference Guide</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="_kerberos">Kerberos brokering</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Keycloak supports login with Kerberos ticket through SPNEGO.
SPNEGO (Simple and Protected GSSAPI Negotiation Mechanism) is used to authenticate transparently through the web browser after the user has been authenticated when logging-in his session.
For non-web cases or when ticket is not available during login, Keycloak also supports login with Kerberos username/password.</p>
</div>
<div class="paragraph">
<p>A typical use case for web authentication is the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>User logs into his desktop (Such as a Windows machine in Active Directory domain or Linux machine with Kerberos integration enabled).</p>
</li>
<li>
<p>User then uses his browser (IE/Firefox/Chrome) to access a web application secured by Keycloak.</p>
</li>
<li>
<p>Application redirects to Keycloak login.</p>
</li>
<li>
<p>Keycloak sends HTML login screen together with status 401 and HTTP header <code>WWW-Authenticate: Negotiate</code></p>
</li>
<li>
<p>In case that browser has Kerberos ticket from desktop login, it transfers the desktop sign on information to the Keycloak in header <code>Authorization: Negotiate &apos;spnego-token&apos;</code> . Otherwise it just displays login screen.</p>
</li>
<li>
<p>Keycloak validates token from browser and authenticate user.
It provisions user data from LDAP (in case of LDAPFederationProvider with Kerberos authentication support) or let user to update his profile and prefill data (in case of KerberosFederationProvider).</p>
</li>
<li>
<p>Keycloak returns back to the application.
Communication between Keycloak and application happens through OpenID Connect or SAML messages.
The fact that Keycloak was authenticated through Kerberos is hidden from the application.
So Keycloak acts as broker to Kerberos/SPNEGO login.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For setup there are 3 main parts:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Setup and configuration of Kerberos server (KDC)</p>
</li>
<li>
<p>Setup and configuration of Keycloak server</p>
</li>
<li>
<p>Setup and configuration of client machines</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setup_of_kerberos_server">Setup of Kerberos server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is platform dependent.
Exact steps depend on your OS and the Kerberos vendor you&#x2019;re going to use.
Consult Windows Active Directory, MIT Kerberos and your OS documentation for how exactly to setup and configure Kerberos server.</p>
</div>
<div class="paragraph">
<p>At least you will need to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add some user principals to your Kerberos database.
You can also integrate your Kerberos with LDAP, which means that user accounts will be provisioned from LDAP server.</p>
</li>
<li>
<p>Add service principal for &quot;HTTP&quot; service.
For example if your Keycloak server will be running on <code>www.mydomain.org</code> you may need to add principal <code>HTTP/www.mydomain.org@MYDOMAIN.ORG</code>                        assuming that MYDOMAIN.ORG will be your Kerberos realm.</p>
<div class="paragraph">
<p>For example on MIT Kerberos you can run &quot;kadmin&quot; session.
If you are on same machine where is MIT Kerberos, you can simply use command:</p>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>sudo kadmin.local</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then add HTTP principal and export his key to keytab file with the commands like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>addprinc -randkey HTTP/www.mydomain.org@MYDOMAIN.ORG
ktadd -k /tmp/http.keytab HTTP/www.mydomain.org@MYDOMAIN.ORG</code></pre>
</div>
</div>
<div class="paragraph">
<p>Keytab file <code>/tmp/http.keytab</code> will need to be accessible on the host where keycloak server will be running.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setup_and_configuration_of_keycloak_server">Setup and configuration of Keycloak server</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Install kerberos client.
  This is again platform dependent.
  If you are on Fedora, Ubuntu or RHEL, you can install package <code>freeipa-client</code>, which contains Kerberos client and bunch of other stuff.
Configure kerberos client (on linux it&#x2019;s in file <code>/etc/krb5.conf</code> ). You need to put your Kerberos realm and at least configure the Http domains your server will be running on.
For the example realm MYDOMAIN.ORG you may configure <code>domain_realm</code> section like this:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>[domain_realm]
  .mydomain.org = MYDOMAIN.ORG
  mydomain.org = MYDOMAIN.ORG</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Export keytab file with HTTP principal and make sure the file is accessible to the process under which Keycloak server is running.</p>
<div class="ulist">
<ul>
<li>
<p>For production, it&#x2019;s ideal if it&#x2019;s readable just by this process and not by someone else.</p>
</li>
<li>
<p>For MIT Kerberos example above, we already exported keytab to <code>/tmp/http.keytab</code> . If your KDC and Keycloak are running on same host, you have file already available.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Run Keycloak server and configure SPNEGO/Kerberos authentication in Keycloak admin console.
Keycloak supports Kerberos authentication through <a href="#_user_federation">Federation provider SPI</a> . We have 2 federation providers with Kerberos authentication support:</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Kerberos</dt>
<dd>
<p>This provider is useful if you want to authenticate with Kerberos <code>NOT</code> backed by LDAP server.
In this case, users are usually created to Keycloak database after first successful SPNEGO/Kerberos login and they may need to update profile after first login, as Kerberos protocol itself doesn&#x2019;t provision any data like first name, last name or email.</p>
</dd>
<dt class="hdlist1">LDAP</dt>
<dd>
<p>This provider is useful if you want to authenticate with Kerberos backed by LDAP server.</p>
</dd>
</dl>
</div>
</li>
<li>
<p>In this case, data about users are provisioned from LDAP server after successful Kerberos authentication.</p>
</li>
<li>
<p>Finally you may need to check the Kerberos authenticator correctly configured.
You can go to <code>Authentication</code> tab in admin console and select <code>Browser</code> flow.
Here you will see <code>Kerberos</code> authenticator, which is used by Keycloak for SPNEGO handshake with client (exchange <code>Negotiate</code> header etc.). By default it&#x2019;s disabled, so Keycloak doesn&#x2019;t ask for Negotiate header, however once you configured federation provider in previous step, it&#x2019;s automatically switched to <code>ALTERNATIVE</code>.
So defacto you don&#x2019;t need to do anything, just check that it&#x2019;s really switched to Alternative.</p>
<div class="paragraph">
<p>Alternative means that Keycloak tries to ask browser for Negotiate header, but if it&#x2019;s not available, it will continue on next authenticator (which usually means displaying username/password form to user). You can switch to <code>REQUIRED</code> if you want to enforce login with kerberos ticket and not allow fallback to username/password form.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setup_and_configuration_of_client_machines">Setup and configuration of client machines</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Clients need to install kerberos client and setup krb5.conf as described above.
Additionally they need to enable SPNEGO login support in their browser.
See for example <a href="http://www.microhowto.info/howto/configure_firefox_to_authenticate_using_spnego_and_kerberos.html" target="_blank">this</a>   for more info about Firefox.
URI <code>.mydomain.org</code> must be allowed in <code>network.negotiate-auth.trusted-uris</code> config option.</p>
</div>
<div class="paragraph">
<p>In windows domain, clients usually don&#x2019;t need to configure anything special as IE is already able to participate in SPNEGO authentication for the windows domain.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_example_setups">Example setups</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For easier testing with Kerberos, we provided some example setups to test.</p>
</div>
<div class="sect2">
<h3 id="_keycloak_and_freeipa_docker_image">Keycloak and FreeIPA docker image</h3>
<div class="paragraph">
<p>Once you install <a href="https://www.docker.com/" target="_blank">docker</a>, you can run docker image with <a href="http://www.freeipa.org/" target="_blank">FreeIPA</a>         server installed.
FreeIPA provides integrated security solution with MIT Kerberos and 389 LDAP server among other things . The image provides also Keycloak server configured with LDAP Federation provider and enabled SPNEGO/Kerberos authentication against the FreeIPA server.
See details <a href="https://github.com/mposolda/keycloak-freeipa-docker/blob/master/README.md" target="_blank">here</a> .</p>
</div>
</div>
<div class="sect2">
<h3 id="_apacheds_testing_kerberos_server">ApacheDS testing Kerberos server</h3>
<div class="paragraph">
<p>For quick testing and unit tests, we use very simple <a href="http://directory.apache.org/apacheds/" target="_blank">ApacheDS</a> Kerberos server.
You need to build Keycloak from sources and then run Kerberos server with maven-exec-plugin from our testsuite.
See details <a href="https://github.com/keycloak/keycloak/blob/master/misc/Testsuite.md#kerberos-server" target="_blank">here</a> .</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_credential_delegation">Credential delegation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One scenario supported by Kerberos 5 is credential delegation.
In this case when user receives forwardable TGT and authenticates to the web server, then web server might be able to reuse the ticket and forward it to another service secured by Kerberos (for example LDAP server or IMAP server).</p>
</div>
<div class="paragraph">
<p>The scenario is supported by Keycloak, but there is tricky thing that SPNEGO authentication is done by Keycloak server but GSS credential will need to be used by your application.
So you need to enable built-in <code>gss delegation credential</code> protocol mapper in admin console for your application.
This will cause that Keycloak will deserialize GSS credential and transmit it to the application in access token.
Application will need to deserialize it and use it for further GSS calls against other services.
We have an example, which is showing it in details.
It&#x2019;s in <code>examples/kerberos</code> in the Keycloak example distribution or demo distribution download.
You can also check the example sources directly <a href="https://github.com/keycloak/keycloak/blob/master/examples/kerberos" target="_blank">here</a> .</p>
</div>
<div class="paragraph">
<p>Once you deserialize the credential from the access token to the GSSCredential object, then GSSContext will need to be created with this credential passed to the method <code>GSSManager.createContext</code> for example like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>GSSContext context = gssManager.createContext(serviceName, krb5Oid,
    deserializedGssCredFromKeycloakAccessToken, GSSContext.DEFAULT_LIFETIME);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you also need to configure <code>forwardable</code> kerberos tickets in <code>krb5.conf</code> file and add support for delegated credentials to your browser.
For details, see the kerberos example from Keycloak examples set as mentioned above.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Credential delegation has some security implications.
So enable the protocol claim and support in browser just if you really need it.
It&#x2019;s highly recommended to use it together with HTTPS.
See for example <a href="http://www.microhowto.info/howto/configure_firefox_to_authenticate_using_spnego_and_kerberos.html#idp27072" target="_blank">this article</a>                for details.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_troubleshooting">Troubleshooting</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you have issues, we recommend to enable more logging by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enable <code>Debug</code> flag in admin console for Kerberos or LDAP federation providers</p>
</li>
<li>
<p>Enable TRACE logging for category <code>org.keycloak</code> in logging section of <code>$WILDFLY_HOME/standalone/configuration/standalone.xml</code> to receive more info <code>$WILDFLY_HOME/standalone/log/server.log</code></p>
</li>
<li>
<p>Add system properties <code>-Dsun.security.krb5.debug=true</code> and <code>-Dsun.security.spnego.debug=true</code></p>
</li>
</ul>
</div>
</div>
</div>
                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../topics/user-federation.html" class="navigation navigation-prev " aria-label="Previous page: User Federation SPI and LDAP/AD Integration"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../topics/export-import.html" class="navigation navigation-next " aria-label="Next page: Export and Import"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-livereload/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"livereload":{}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
