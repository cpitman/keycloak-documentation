<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Javascript Adapter | Keycloak</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="../topics/spring-boot-adapter.html" />
    
    
    <link rel="prev" href="../topics/fuse-adapter.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="8.7"
        data-chapter-title="Javascript Adapter"
        data-filepath="topics/javascript-adapter.adoc"
        data-basepath=".."
        data-revision="Tue Apr 05 2016 21:38:08 GMT+0530 (IST)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="topics/preface.html">
            
            <span><b>1.</b> Overview</span>
            
            
        </li>
    
        <li class="chapter " data-level="2" data-path="topics/Overview.html">
            
                
                    <a href="../topics/Overview.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Overview
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3" data-path="topics/server-installation.html">
            
                
                    <a href="../topics/server-installation.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Installation and Configuration of Keycloak Server
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="topics/providers.html">
            
                
                    <a href="../topics/providers.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Providers and SPIs
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5" data-path="topics/openshift.html">
            
                
                    <a href="../topics/openshift.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        Running Keycloak Server on OpenShift
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6" data-path="topics/admin-permissions.html">
            
                
                    <a href="../topics/admin-permissions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        Master Admin Access Control
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7" data-path="topics/per-realm-admin-permissions.html">
            
                
                    <a href="../topics/per-realm-admin-permissions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        Per Realm Admin Access Control
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8" data-path="topics/adapter-config.html">
            
                
                    <a href="../topics/adapter-config.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        Adapters
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="8.1" data-path="topics/jboss-adapter.html">
            
                
                    <a href="../topics/jboss-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.1.</b>
                        
                        JBoss/Wildfly Adapter
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="topics/tomcat-adapter.html">
            
                
                    <a href="../topics/tomcat-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.2.</b>
                        
                        Tomcat 6, 7 and 8 Adapters
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.3" data-path="topics/jetty9-adapter.html">
            
                
                    <a href="../topics/jetty9-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.3.</b>
                        
                        Jetty 9.x Adapters
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.4" data-path="topics/jetty8-adapter.html">
            
                
                    <a href="../topics/jetty8-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.4.</b>
                        
                        Jetty 8.1.x Adapter
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.5" data-path="topics/servlet-filter-adapter.html">
            
                
                    <a href="../topics/servlet-filter-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.5.</b>
                        
                        Java Servlet Filter Adapter
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.6" data-path="topics/fuse-adapter.html">
            
                
                    <a href="../topics/fuse-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.6.</b>
                        
                        JBoss Fuse and Apache Karaf Adapter
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="8.7" data-path="topics/javascript-adapter.html">
            
                
                    <a href="../topics/javascript-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.7.</b>
                        
                        Javascript Adapter
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.8" data-path="topics/spring-boot-adapter.html">
            
                
                    <a href="../topics/spring-boot-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.8.</b>
                        
                        Spring Boot Adapter
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.9" data-path="topics/spring-security-adapter.html">
            
                
                    <a href="../topics/spring-security-adapter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.9.</b>
                        
                        Spring Security Adapter
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.10" data-path="topics/installed-applications.html">
            
                
                    <a href="../topics/installed-applications.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.10.</b>
                        
                        Installed Applications
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.11" data-path="topics/logout.html">
            
                
                    <a href="../topics/logout.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.11.</b>
                        
                        Logout
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.12" data-path="topics/adapter_error_handling.html">
            
                
                    <a href="../topics/adapter_error_handling.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.12.</b>
                        
                        Error Handling
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.13" data-path="topics/multi-tenancy.html">
            
                
                    <a href="../topics/multi-tenancy.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.13.</b>
                        
                        Multi Tenancy
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.14" data-path="topics/jaas.html">
            
                
                    <a href="../topics/jaas.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.14.</b>
                        
                        JAAS plugin
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="9" data-path="topics/client-registration.html">
            
                
                    <a href="../topics/client-registration.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                        Client Registration
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10" data-path="topics/identity-broker.html">
            
                
                    <a href="../topics/identity-broker.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                        Identity Broker
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="11" data-path="topics/themes.html">
            
                
                    <a href="../topics/themes.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>11.</b>
                        
                        Themes
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="12" data-path="topics/recaptcha.html">
            
                
                    <a href="../topics/recaptcha.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>12.</b>
                        
                        Recaptcha Support on Registration
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="13" data-path="topics/email.html">
            
                
                    <a href="../topics/email.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>13.</b>
                        
                        Email
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="14" data-path="topics/access-types.html">
            
                
                    <a href="../topics/access-types.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>14.</b>
                        
                        Client Access Types
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="15" data-path="topics/roles.html">
            
                
                    <a href="../topics/roles.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>15.</b>
                        
                        Roles
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="16" data-path="topics/groups.html">
            
                
                    <a href="../topics/groups.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>16.</b>
                        
                        Groups
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="17" data-path="topics/direct-access.html">
            
                
                    <a href="../topics/direct-access.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>17.</b>
                        
                        Direct Access Grants
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="18" data-path="topics/service-accounts.html">
            
                
                    <a href="../topics/service-accounts.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>18.</b>
                        
                        Service Accounts
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="19" data-path="topics/cors.html">
            
                
                    <a href="../topics/cors.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>19.</b>
                        
                        CORS
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="20" data-path="topics/timeouts.html">
            
                
                    <a href="../topics/timeouts.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>20.</b>
                        
                        Cookie settings, Session Timeouts, and Token Lifespans
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="21" data-path="topics/admin-rest-api.html">
            
                
                    <a href="../topics/admin-rest-api.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>21.</b>
                        
                        Admin REST API
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="22" data-path="topics/events.html">
            
                
                    <a href="../topics/events.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>22.</b>
                        
                        Events
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="23" data-path="topics/user-federation.html">
            
                
                    <a href="../topics/user-federation.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>23.</b>
                        
                        User Federation SPI and LDAP/AD Integration
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="24" data-path="topics/kerberos.html">
            
                
                    <a href="../topics/kerberos.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>24.</b>
                        
                        Kerberos brokering
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="25" data-path="topics/export-import.html">
            
                
                    <a href="../topics/export-import.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>25.</b>
                        
                        Export and Import
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="26" data-path="topics/cache.html">
            
                
                    <a href="../topics/cache.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>26.</b>
                        
                        Server Cache
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="27" data-path="topics/saml.html">
            
                
                    <a href="../topics/saml.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>27.</b>
                        
                        SAML SSO
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="28" data-path="topics/security-vulnerabilities.html">
            
                
                    <a href="../topics/security-vulnerabilities.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>28.</b>
                        
                        Security Vulnerabilities
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="29" data-path="topics/clustering.html">
            
                
                    <a href="../topics/clustering.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>29.</b>
                        
                        Clustering
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="30" data-path="topics/application-clustering.html">
            
                
                    <a href="../topics/application-clustering.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>30.</b>
                        
                        Application Clustering
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="31" data-path="topics/proxy.html">
            
                
                    <a href="../topics/proxy.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>31.</b>
                        
                        Keycloak Security Proxy
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="32" data-path="topics/custom-attributes.html">
            
                
                    <a href="../topics/custom-attributes.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>32.</b>
                        
                        Custom User Attributes
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="33" data-path="topics/protocol-mappers.html">
            
                
                    <a href="../topics/protocol-mappers.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>33.</b>
                        
                        OIDC Token and SAML Assertion Mappings
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="34" data-path="topics/auth-spi.html">
            
                
                    <a href="../topics/auth-spi.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>34.</b>
                        
                        Custom Authentication, Registration, and Required Actions
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="35" data-path="topics/MigrationFromOlderVersions.html">
            
                
                    <a href="../topics/MigrationFromOlderVersions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>35.</b>
                        
                        Migration from older versions
                    </a>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >Keycloak</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="javascript-adapter">Javascript Adapter</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The Keycloak Server comes with a Javascript library you can use to secure HTML/Javascript applications.
This library is referenceable directly from the keycloak server.
You can also download the adapter from Keycloak&#x2019;s download site if you want a static copy.
It works in the same way as other application adapters except that your browser is driving the OAuth redirect protocol rather than the server.</p>
</div>
<div class="paragraph">
<p>The disadvantage of using this approach is that you have a non-confidential, public client.
This makes it more important that you register valid redirect URLs and make sure your domain name is secured.</p>
</div>
<div class="paragraph">
<p>To use this adapter, you must first configure an application (or client) through the <code>Keycloak Admin Console</code>.
You should select <code>public</code> for the <code>Access Type</code> field.
As public clients can&#x2019;t be verified with a client secret, you are required to configure one or more valid redirect uris.
Once you&#x2019;ve configured the application, click on the <code>Installation</code> tab and download the <code>keycloak.json</code>        file.
This file should be hosted on your web-server at the same root as your HTML pages.
Alternatively, you can manually configure the adapter and specify the URL for this file.</p>
</div>
<div class="paragraph">
<p>Next, you have to initialize the adapter in your application.
An example is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html"><span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">&quot;http://&lt;keycloak server&gt;/auth/js/keycloak.js&quot;</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="actionscript">
        <span class="hljs-keyword">var</span> keycloak = Keycloak();
        keycloak.init().success(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(authenticated)</span> </span>{
            alert(authenticated ? <span class="hljs-string">&apos;authenticated&apos;</span> : <span class="hljs-string">&apos;not authenticated&apos;</span>);
        }).error(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            alert(<span class="hljs-string">&apos;failed to initialize&apos;</span>);
        });
    </span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To specify the location of the keycloak.json file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>var keycloak = Keycloak(&apos;http://localhost:8080/myapp/keycloak.json&apos;));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or finally to manually configure the adapter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>var keycloak = Keycloak({
    url: &apos;http://keycloak-server/auth&apos;,
    realm: &apos;myrealm&apos;,
    clientId: &apos;myapp&apos;
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also pass <code>login-required</code> or <code>check-sso</code> to the init function.
Login required will cause a redirect to the login form on the server, while check-sso will simply redirect to the auth server to check if the user is already logged in to the realm.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>keycloak.init({ onLoad: &apos;login-required&apos; })</code></pre>
</div>
</div>
<div class="paragraph">
<p>After you login, your application will be able to make REST calls using bearer token authentication.
Here&#x2019;s an example pulled from the <code>customer-portal-js</code> example that comes with the distribution.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;script&gt;
    var loadData = function () {
        document.getElementById(&apos;username&apos;).innerText = keycloak.username;

        var url = &apos;http://localhost:8080/database/customers&apos;;

        var req = new XMLHttpRequest();
        req.open(&apos;GET&apos;, url, true);
        req.setRequestHeader(&apos;Accept&apos;, &apos;application/json&apos;);
        req.setRequestHeader(&apos;Authorization&apos;, &apos;Bearer &apos; + keycloak.token);

        req.onreadystatechange = function () {
            if (req.readyState == 4) {
                if (req.status == 200) {
                    var users = JSON.parse(req.responseText);
                    var html = &apos;&apos;;
                    for (var i = 0; i &lt; users.length; i++) {
                        html += &apos;&lt;p&gt;&apos; + users[i] + &apos;&lt;/p&gt;&apos;;
                    }
                    document.getElementById(&apos;customers&apos;).innerHTML = html;
                    console.log(&apos;finished loading data&apos;);
                }
            }
        }

        req.send();
    };

    var loadFailure = function () {
        document.getElementById(&apos;customers&apos;).innerHTML = &apos;&lt;b&gt;Failed to load data.  Check console log&lt;/b&gt;&apos;;

    };

    var reloadData = function () {
        keycloak.updateToken().success(loadData).error(loadFailure);
    }
&lt;/script&gt;

&lt;button onclick=&quot;reloadData()&quot;&gt;Submit&lt;/button&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>loadData()</code> method builds an HTTP request setting the <code>Authorization</code>        header to a bearer token.
The <code>keycloak.token</code> points to the access token the browser obtained when it logged you in.
The <code>loadFailure()</code> method is invoked on a failure.
The <code>reloadData()</code>        function calls <code>keycloak.updateToken()</code> passing in the <code>loadData()</code> and <code>loadFailure()</code> callbacks.
The <code>keycloak.updateToken()</code> method checks to see if the access token hasn&#x2019;t expired.
If it hasn&#x2019;t, and your oauth login returned a refresh token, this method will refresh the access token.
Finally, if successful, it will invoke the success callback, which in this case is the <code>loadData()</code> method.</p>
</div>
<div class="paragraph">
<p>To refresh the token when it is expired, call the <code>updateToken</code> method.
This method returns a promise object, which can be used to invoke a function on success or failure.
This method can be used to wrap functions that should only be called with a valid token.
For example, the following method will refresh the token if it expires within 30 seconds, and then invoke the specified function.
If the token is valid for more than 30 seconds it will just call the specified function.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>keycloak.updateToken(30).success(function() {
    // send request with valid token
}).error(function() {
    alert(&apos;failed to refresh token&apos;);
);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_session_status_iframe">Session status iframe</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, the JavaScript adapter creates a non-visible iframe that is used to detect if a single-sign out has occurred.
This does not require any network traffic, instead the status is retrieved from a special status cookie.
This feature can be disabled by setting <code>checkLoginIframe: false</code> in the options passed to the <code>init</code>            method.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_javascript_implicit_flow">Implicit and Hybrid Flow</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, the JavaScript adapter uses <a href="http://openid.net/specs/openid-connect-core-1_0.html#CodeFlowAuth" target="_blank">OpenID Connect standard (Authorization code) flow</a>, which means that after authentication, the Keycloak server redirects the user back to your application, where the JavaScript adapter will exchange the <code>code</code> for an access token and a refresh token.</p>
</div>
<div class="paragraph">
<p>However, Keycloak also supports <a href="http://openid.net/specs/openid-connect-core-1_0.html#ImplicitFlowAuth" target="_blank">OpenID Connect Implicit flow</a> where an access token is sent immediately after successful authentication with Keycloak (there is no additional request for exchange code). This could have better performance than standard flow, as there is no additional request to exchange the code for tokens.
However, sending the access token in the URL fragment could pose a security issue in some environments (access logs might expose tokens located in the URL).</p>
</div>
<div class="paragraph">
<p>To enable implicit flow, you need to enable the <code>Implicit Flow Enabled</code> flag for the client in the Keycloak admin console.
You also need to pass the parameter <code>flow</code> with value <code>implicit</code> to <code>init</code> method.
An example is below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>keycloak.init({ flow: &apos;implicit&apos; })</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that with implicit flow, you are not given a refresh token after authentication.</p>
</div>
<div class="paragraph">
<p>This makes it harder for your application to periodically update the access token in background (without browser redirection). It&#x2019;s recommended that you implement an <code>onTokenExpired</code> callback method on the keycloak object, so you are notified after the token is expired (For example you can call keycloak.login, which will redirect browser to Keycloak login screen and it will immediately redirect you back if the SSO session is still valid and the user is still logged.
However, make sure to save the application state before performing a redirect.)</p>
</div>
<div class="paragraph">
<p>Keycloak also has support for <a href="http://openid.net/specs/openid-connect-core-1_0.html#HybridFlowAuth" target="_blank">OpenID Connect Hybrid flow</a>.</p>
</div>
<div class="paragraph">
<p>This requires the client to have both the <code>Standard Flow Enabled</code> and <code>Implicit Flow Enabled</code> flags enabled in the admin console.
The Keycloak server will then send both the code and tokens to your application.
The access token can be used immediately while the code can be exchanged for access and refresh tokens.
Similar to the implicit flow, the hybrid flow is good for performance because the access token is available immediately.
But, the token is still sent in the URL, and security risks might still apply.
However, one advantage over the implicit flow is that a refresh token is made available to the application (after the code-to-token request is finished).</p>
</div>
<div class="paragraph">
<p>For hybrid flow, you need to pass the parameter <code>flow</code> with value <code>hybrid</code> to <code>init</code> method.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_older_browsers">Older browsers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The JavaScript adapter depends on Base64 (window.btoa and window.atob) and HTML5 History API.
If you need to support browsers that don&#x2019;t provide those (for example IE9) you&#x2019;ll need to add polyfillers.
Example polyfill libraries:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/davidchambers/Base64.js" class="bare" target="_blank">https://github.com/davidchambers/Base64.js</a></p>
</li>
<li>
<p><a href="https://github.com/devote/HTML5-History-API" class="bare" target="_blank">https://github.com/devote/HTML5-History-API</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_javascript_adapter_reference">JavaScript Adapter reference</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_constructor">Constructor</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>new Keycloak();
new Keycloak(&apos;http://localhost/keycloak.json&apos;);
new Keycloak({ url: &apos;http://localhost/auth&apos;, realm: &apos;myrealm&apos;, clientId: &apos;myApp&apos; });</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_properties">Properties</h3>
<div class="ulist">
<ul>
<li>
<p>authenticated - true if the user is authenticated</p>
</li>
<li>
<p>Authorization</p>
</li>
<li>
<p>tokenParsed - the parsed token</p>
</li>
<li>
<p>subject - the user id</p>
</li>
<li>
<p>idToken - the id token if claims is enabled for the application, null otherwise</p>
</li>
<li>
<p>idTokenParsed - the parsed id token</p>
</li>
<li>
<p>realmAccess - the realm roles associated with the token</p>
</li>
<li>
<p>resourceAccess - the resource roles assocaited with the token</p>
</li>
<li>
<p>refreshToken - the base64 encoded token that can be used to retrieve a new token</p>
</li>
<li>
<p>refreshTokenParsed - the parsed refresh token</p>
</li>
<li>
<p>timeSkew - estimated skew between local time and Keycloak server in seconds</p>
</li>
<li>
<p>fragment</p>
</li>
<li>
<p>Implicit flow</p>
</li>
<li>
<p>flow</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_methods">Methods</h3>
<div class="sect3">
<h4 id="_init_options">init(options)</h4>
<div class="paragraph">
<p>Called to initialize the adapter.</p>
</div>
<div class="paragraph">
<p>Options is an Object, where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>onLoad - specifies an action to do on load, can be either &apos;login-required&apos; or &apos;check-sso&apos;</p>
</li>
<li>
<p>token - set an initial value for the token</p>
</li>
<li>
<p>refreshToken - set an initial value for the refresh token</p>
</li>
<li>
<p>idToken - set an initial value for the id token (only together with token or refreshToken)</p>
</li>
<li>
<p>timeSkew - set an initial value for skew between local time and Keycloak server in seconds (only together with token or refreshToken)</p>
</li>
<li>
<p>checkLoginIframe - set to enable/disable monitoring login state (default is true)</p>
</li>
<li>
<p>checkLoginIframeInterval - set the interval to check login state (default is 5 seconds)</p>
</li>
<li>
<p>query
+<code>fragment</code>
+<code>fragment</code>
+<code>query</code></p>
</li>
<li>
<p>standard
+<code>implicit</code>
+<code>hybrid</code><a href="#_javascript_implicit_flow">+Implicit flow</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Returns promise to set functions to be invoked on success or error.</p>
</div>
</div>
<div class="sect3">
<h4 id="_login_options">login(options)</h4>
<div class="paragraph">
<p>Redirects to login form on (options is an optional object with redirectUri and/or prompt fields)</p>
</div>
<div class="paragraph">
<p>Options is an Object, where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>redirectUri - specifies the uri to redirect to after login</p>
</li>
<li>
<p>prompt - can be set to &apos;none&apos; to check if the user is logged in already (if not logged in, a login form is not displayed)</p>
</li>
<li>
<p>loginHint - used to pre-fill the username/email field on the login form</p>
</li>
<li>
<p>action - if value is &apos;register&apos; then user is redirected to registration page, otherwise to login page</p>
</li>
<li>
<p>locale - specifies the desired locale for the UI</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_createloginurl_options">createLoginUrl(options)</h4>
<div class="paragraph">
<p>Returns the url to login form on (options is an optional object with redirectUri and/or prompt fields)</p>
</div>
<div class="paragraph">
<p>Options is an Object, where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>redirectUri - specifies the uri to redirect to after login</p>
</li>
<li>
<p>prompt - can be set to &apos;none&apos; to check if the user is logged in already (if not logged in, a login form is not displayed)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_logout_options">logout(options)</h4>
<div class="paragraph">
<p>Redirects to logout</p>
</div>
<div class="paragraph">
<p>Options is an Object, where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>redirectUri - specifies the uri to redirect to after logout</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_createlogouturl_options">createLogoutUrl(options)</h4>
<div class="paragraph">
<p>Returns logout out</p>
</div>
<div class="paragraph">
<p>Options is an Object, where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>redirectUri - specifies the uri to redirect to after logout</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_register_options">register(options)</h4>
<div class="paragraph">
<p>Redirects to registration form.
It&#x2019;s a shortcut for doing login with option action = &apos;register&apos;</p>
</div>
<div class="paragraph">
<p>Options are same as login method but &apos;action&apos; is overwritten to &apos;register&apos;</p>
</div>
</div>
<div class="sect3">
<h4 id="_createregisterurl_options">createRegisterUrl(options)</h4>
<div class="paragraph">
<p>Returns the url to registration page.
It&#x2019;s a shortcut for doing createRegisterUrl with option action = &apos;register&apos;</p>
</div>
<div class="paragraph">
<p>Options are same as createLoginUrl method but &apos;action&apos; is overwritten to &apos;register&apos;</p>
</div>
</div>
<div class="sect3">
<h4 id="_accountmanagement">accountManagement()</h4>
<div class="paragraph">
<p>Redirects to account management</p>
</div>
</div>
<div class="sect3">
<h4 id="_createaccounturl">createAccountUrl()</h4>
<div class="paragraph">
<p>Returns the url to account management</p>
</div>
</div>
<div class="sect3">
<h4 id="_hasrealmrole_role">hasRealmRole(role)</h4>
<div class="paragraph">
<p>Returns true if the token has the given realm role</p>
</div>
</div>
<div class="sect3">
<h4 id="_hasresourcerole_role_resource">hasResourceRole(role, resource)</h4>
<div class="paragraph">
<p>Returns true if the token has the given role for the resource (resource is optional, if not specified clientId is used)</p>
</div>
</div>
<div class="sect3">
<h4 id="_loaduserprofile">loadUserProfile()</h4>
<div class="paragraph">
<p>Loads the users profile</p>
</div>
<div class="paragraph">
<p>Returns promise to set functions to be invoked on success or error.</p>
</div>
</div>
<div class="sect3">
<h4 id="_istokenexpired_minvalidity">isTokenExpired(minValidity)</h4>
<div class="paragraph">
<p>Returns true if the token has less than minValidity seconds left before it expires (minValidity is optional, if not specified 0 is used)</p>
</div>
</div>
<div class="sect3">
<h4 id="_updatetoken_minvalidity">updateToken(minValidity)</h4>
<div class="paragraph">
<p>If the token expires within minValidity seconds (minValidity is optional, if not specified 0 is used) the token is refreshed.
If the session status iframe is enabled, the session status is also checked.</p>
</div>
<div class="paragraph">
<p>Returns promise to set functions that can be invoked if the token is still valid, or if the token is no longer valid.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>keycloak.updateToken(5).success(function(refreshed) {
        if (refreshed) {
            alert(&apos;token was successfully refreshed&apos;);
        } else {
            alert(&apos;token is still valid&apos;);
        }
    }).error(function() {
        alert(&apos;failed to refresh the token, or the session has expired&apos;);
    });</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cleartoken">clearToken()</h4>
<div class="paragraph">
<p>Clear authentication state, including tokens.
This can be useful if application has detected the session has expired, for example if updating token fails.
Invoking this results in onAuthLogout callback listener being invoked.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>keycloak.updateToken(5).error(function() {
    keycloak.clearToken();
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_callback_events">Callback Events</h3>
<div class="paragraph">
<p>The adapter supports setting callback listeners for certain events.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>keycloak.onAuthSuccess = function() { alert(&apos;authenticated&apos;); }</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>onReady(authenticated) - called when the adapter is initialized</p>
</li>
<li>
<p>onAuthSuccess - called when a user is successfully authenticated</p>
</li>
<li>
<p>onAuthError - called if there was an error during authentication</p>
</li>
<li>
<p>onAuthRefreshSuccess - called when the token is refreshed</p>
</li>
<li>
<p>onAuthRefreshError - called if there was an error while trying to refresh the token</p>
</li>
<li>
<p>onAuthLogout - called if the user is logged out (will only be called if the session status iframe is enabled, or in Cordova mode)</p>
</li>
<li>
<p>onTokenExpired - called when access token expired. When this happens you can for example refresh token, or if refresh not available (ie. with implicit flow) you can redirect to login screen</p>
</li>
</ul>
</div>
</div>
</div>
</div>
                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../topics/fuse-adapter.html" class="navigation navigation-prev " aria-label="Previous page: JBoss Fuse and Apache Karaf Adapter"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../topics/spring-boot-adapter.html" class="navigation navigation-next " aria-label="Next page: Spring Boot Adapter"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-livereload/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"livereload":{}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
